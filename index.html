<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Control de Ventas - Banda Orquesta</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        padding: 0;
        background: #f4f6f9;
        color: #333;
        display: flex;
        justify-content: center;
    }

    .container {
        width: 90%;
        max-width: 650px;
        background: #fff;
        margin: 40px 0;
        padding: 30px;
        border-radius: 18px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        animation: fadeIn 0.7s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    h1 {
        text-align: center;
        font-weight: 600;
        margin-bottom: 20px;
    }

    h2 {
        margin-top: 35px;
        font-weight: 500;
        border-left: 4px solid #4A6CF7;
        padding-left: 10px;
        color: #4A6CF7;
    }

    input, button {
        width: 100%;
        padding: 12px;
        margin: 8px 0;
        border-radius: 10px;
        border: 1px solid #ccc;
        font-size: 14px;
        transition: 0.2s;
    }

    input:focus {
        outline: none;
        border-color: #4A6CF7;
        box-shadow: 0 0 4px rgba(74,108,247,0.4);
    }

    button {
        background: #4A6CF7;
        color: #fff;
        border: none;
        font-weight: 500;
        cursor: pointer;
    }

    button:hover {
        transform: scale(1.03);
        background: #3a57d3;
    }

    .pedido {
        background: #f9fafc;
        border: 1px solid #e1e5ee;
        padding: 15px;
        margin: 12px 0;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        animation: popIn 0.3s ease;
    }

    @keyframes popIn {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
    }

    .entregado {
        border-left: 4px solid #16c47f;
    }

    .pendiente {
        border-left: 4px solid #f7b731;
    }

    .acciones {
        margin-top: 10px;
        display: flex;
        gap: 10px;
    }

    .acciones button {
        flex: 1;
        padding: 10px;
        font-size: 13px;
        border-radius: 8px;
    }

    .total-box {
        font-size: 22px;
        font-weight: 600;
        text-align: center;
        background: #4A6CF7;
        color: #fff;
        padding: 15px;
        margin-top: 30px;
        border-radius: 14px;
    }
</style>
</head>
<body>

<!-- Start-up audio: the file the user provided -->
<audio id="startup" src="https://screenapp.io/app/v/E1k8O8t0Lq" autoplay playsinline></audio>

<audio id="sound-add" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
<audio id="sound-done" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg" preload="auto"></audio>
<audio id="sound-delete" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>

<div class="container">
<h1>Control de Ventas - Banda Orquesta</h1>

<h2>Agregar Pedido</h2>
<input id="nombre" placeholder="Nombre del comprador">
<input id="producto" placeholder="Producto">
<input id="cantidad" placeholder="Cantidad" type="number">
<input id="precio" placeholder="Precio total ($)" type="number">
<button onclick="agregarPedido()">Agregar</button>

<h2>Buscar Pedido</h2>
<input id="buscar" placeholder="Buscar por nombre o producto" oninput="render()">

<h2>Pedidos Pendientes</h2>
<div id="pendientes"></div>

<h2>Pedidos Entregados</h2>
<div id="entregados"></div>

<div class="total-box">Total Recaudado: $<span id="total">0</span></div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
// --- Audio playback handling ---
// Modern browsers block autoplay with sound until user interaction.
// Strategy: allow autoplay muted so it can load, then play on first user interaction (click/touch).
(function(){
  const startup = document.getElementById('startup');

  // Try to play muted on load so the file is fetched in some browsers
  window.addEventListener('DOMContentLoaded', () => {
    if (startup) {
      // ensure it's muted initially to maximize chance autoplay works
      try { startup.muted = true; startup.play().catch(()=>{}); } catch(e){}
    }
  });

  // On first user interaction, unmute and play the audio once
  const unlockAudio = () => {
    if (!startup) return;
    try {
      startup.muted = false;
      startup.play().catch(()=>{});
    } catch(e){}
  };

  window.addEventListener('click', unlockAudio, { once: true });
  window.addEventListener('touchstart', unlockAudio, { once: true });
})();

// --- Firebase realtime sync ---
// Replace the firebaseConfig object with your project's credentials.
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "123456789",
  appId: "APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
let pedidos = [];
let total = 0;

function playSound(id){
  const s = document.getElementById(id);
  if(!s) return;
  try { s.currentTime = 0; s.play().catch(()=>{}); } catch(e){}
}

function sync(){
  // write full state to database
  db.ref("pedidos").set(pedidos);
  db.ref("total").set(total);
}

// Listen for remote updates
db.ref("pedidos").on("value", snap => {
  pedidos = snap.val() || [];
  render();
});

db.ref("total").on("value", snap => {
  total = snap.val() || 0;
  document.getElementById("total").innerText = total;
});

function agregarPedido(){
  const nombre = document.getElementById("nombre").value.trim();
  const producto = document.getElementById("producto").value.trim();
  const cantidad = Number(document.getElementById("cantidad").value);
  const precio = Number(document.getElementById("precio").value);

  if(!nombre || !producto || !cantidad || !precio){ alert("Completa todos los campos"); return; }

  const pedido = { nombre, producto, cantidad, precio, entregado: false };
  pedidos.push(pedido);
  total += precio;

  playSound('sound-add');
  sync();

  // clear inputs
  document.getElementById("nombre").value = "";
  document.getElementById("producto").value = "";
  document.getElementById("cantidad").value = "";
  document.getElementById("precio").value = "";
}

function marcarEntregado(i){
  if(!pedidos[i]) return;
  pedidos[i].entregado = true;
  playSound('sound-done');
  sync();
}

function eliminarPedido(i){
  if(!pedidos[i]) return;
  playSound('sound-delete');
  total -= pedidos[i].precio;
  pedidos.splice(i,1);
  sync();
}

function render(){
  const pendientesEl = document.getElementById('pendientes');
  const entregadosEl = document.getElementById('entregados');
  if(!pendientesEl || !entregadosEl) return;

  let pHTML = '';
  let eHTML = '';
  const filtro = (document.getElementById('buscar')?.value || '').toLowerCase();

  pedidos.forEach((p, i) => {
    if(!p) return;
    const nombre = String(p.nombre || '');
    const producto = String(p.producto || '');
    if(filtro && !nombre.toLowerCase().includes(filtro) && !producto.toLowerCase().includes(filtro)) return;

    const html = `\n      <div class="pedido ${p.entregado ? 'entregado' : 'pendiente'}">\n        <strong>${escapeHtml(nombre)}</strong><br>\n        ${escapeHtml(producto)} x ${p.cantidad}<br>\n        <strong>Total:</strong> $${p.precio}<br>\n        <div class="acciones">\n          ${!p.entregado ? `<button onclick="marcarEntregado(${i})">Entregar</button>` : ''}\n          <button onclick="eliminarPedido(${i})" style="background:#d9534f">Eliminar</button>\n        </div>\n      </div>\n    `;

    if(p.entregado) eHTML += html; else pHTML += html;
  });

  pendientesEl.innerHTML = pHTML;
  entregadosEl.innerHTML = eHTML;
  document.getElementById('total').innerText = total;
}

// small helper to avoid injection when rendering
function escapeHtml(str) {
  return str.replace(/[&<>"']/g, function(m) { return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[m]; });
}

// initial render (in case database is empty or delayed)
render();
</script>

</body>
</html>
